# Plant Care System - Backend

Система догляду за кімнатними рослинами з автоматичним моніторингом та управлінням через IoT датчики.

## Структура проекту

```
backend/
├── database/
│   └── init/
│       ├── 01-init.sql          # Створення структури БД
│       ├── 02-seed-data.sql     # Тестові дані
│       └── 03-verify.sql        # Перевірочні запити
├── src/                         # Код бекенду (буде створено пізніше)
├── docker-compose.yml           # Конфігурація контейнерів
├── .env                         # Змінні оточення
└── README.md
```

## Швидкий старт

### 1. Встановлення залежностей

```bash
# Переконайтесь, що у вас встановлений Docker та Docker Compose
docker --version
docker-compose --version
```

### 2. Запуск бази даних

```bash
# Запуск PostgreSQL в контейнері
docker-compose up postgres

# Або в фоновому режимі
docker-compose up -d postgres
```

### 3. Підключення до бази даних

База даних буде доступна на:
- **Host:** localhost
- **Port:** 5432
- **Database:** plant_care
- **Username:** plant_user
- **Password:** plant_password

### 4. Перевірка роботи

```bash
# Підключення через psql (якщо встановлений)
psql -h localhost -p 5432 -U plant_user -d plant_care

# Або через Docker
docker exec -it plant_care_db psql -U plant_user -d plant_care
```

### 5. Перезапуск з чистою базою

```bash
# Зупинка контейнерів
docker-compose down

# Видалення даних (база створюється заново)
docker-compose down -v

# Повторний запуск
docker-compose up -d postgres
```

## База даних

### Таблиці

1. **користувачі** - профілі користувачів системи
2. **типи_рослин** - каталог типів рослин з оптимальними параметрами
3. **рослини** - конкретні рослини користувачів
4. **датчики** - IoT датчики прив'язані до рослин
5. **дані_датчиків** - історія вимірювань з датчиків

### Тестові дані

При ініціалізації створюються:
- 3 користувачі (Іван, Марія, Олег)
- 6 типів рослин (Фіалка, Кактус, Папороть, Фікус, Алое, Спатіфілум)
- 9 рослин розподілених між користувачами
- 22 датчики (вологість, температура, освітлення)
- Історія вимірювань за останню годину

### Корисні запити

```sql
-- Перевірка кількості записів
SELECT 'Користувачі:' as table_name, COUNT(*) FROM користувачі
UNION ALL SELECT 'Рослини:', COUNT(*) FROM рослини;

-- Перегляд всіх рослин користувача
SELECT r.назва, tr.назва_типу, r.розташування 
FROM рослини r 
JOIN типи_рослин tr ON r.id_типу_рослини = tr.id_типу_рослини 
WHERE r.id_користувача = 1;

-- Останні показання датчиків
SELECT d.тип_датчика, dd.значення, dd.час_вимірювання
FROM датчики d
JOIN дані_датчиків dd ON d.id_датчика = dd.id_датчика
WHERE d.id_рослини = 1
ORDER BY dd.час_вимірювання DESC;
```

## Наступні кроки

1. Створення Node.js бекенду з Express
2. Налаштування TypeScript та ORM (Sequelize)
3. Реалізація REST API endpoints
4. Додавання автентифікації (JWT)
5. Інтеграція з IoT пристроями (MQTT)
6. WebSocket для real-time оновлень

## Логи та діагностика

```bash
# Перегляд логів PostgreSQL
docker-compose logs postgres

# Перегляд логів у реальному часі
docker-compose logs -f postgres

# Підключення до контейнера
docker exec -it plant_care_db bash
```